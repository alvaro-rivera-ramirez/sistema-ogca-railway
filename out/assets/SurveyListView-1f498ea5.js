import{K as y,r as a,u as z,d as H,j as n,D as ie,I as K,B as g,a5 as re,S as q,T as le,E as ce}from"./index-9512049a.js";import{S as de,T as ue,a as pe,b as me}from"./ShareSurvey-e756b44d.js";import{T as he,g as fe}from"./fetchIndicator-fc6684f5.js";import{a as O,M as W,b as ge,S as Ie}from"./Modal-5cc5ed01.js";import{O as ve,T as I}from"./TextField-14413577.js";import{I as xe}from"./InputAdornment-f4cb8bb5.js";import{A as v}from"./Autocomplete-f91b5d70.js";import{C as Ce}from"./Container-7e28c591.js";import{B as J}from"./Button-fd147fd1.js";import{C as Se}from"./Menu-7d48820f.js";import{a as ye,b as Oe,c as we,d as Me}from"./TablePagination-738ebcf8.js";const je=`${y}/v1/institute`,Q=async(i,r="",l="",d="")=>{let s=new URL(je);r&&s.searchParams.set("page",r),l&&s.searchParams.set("limit",l),d.trim()!==""&&s.searchParams.set("search",d);const u={headers:{Authorization:`Bearer ${i}`}};return(await O.get(s.toString(),u)).data.institutes.map(o=>({id:o.id_institute,name:o.name_institute}))},be=`${y}/v1/evaluation-module`,X=async(i,r="",l="",d="")=>{let s=new URL(be);r&&s.searchParams.set("page",r),l&&s.searchParams.set("limit",l),d.trim()!==""&&s.searchParams.set("search",d);const u={headers:{Authorization:`Bearer ${i}`}};return(await O.get(s.toString(),u)).data.map(o=>({id:o.id_evaluation_module,code:o.code_evaluation_module,name:o.name_evaluation_module}))};function Ee(){const[i,r]=a.useState([]),[l,d]=a.useState([]),{accessToken:s}=z(),{search:u,itemsChange:m}=H(),h=({target:o})=>{const c=o.id;return m[c](o.value)||m.default};return a.useEffect(()=>{async function o(){const x=await Q(s);r([...x])}async function c(){const x=await X(s);d([...x])}o(),c()},[]),n.jsxs(ie,{sx:{height:96,display:"flex",justifyContent:"space-between",p:o=>o.spacing(0,1,0,3)},children:[n.jsx(ve,{id:"input-search",value:u,onChange:h,placeholder:"Search survey...",startAdornment:n.jsx(xe,{position:"start",children:n.jsx(K,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})},"input-search"),n.jsx(v,{multiple:!1,onChange:({target:o})=>{console.log(o.value),h({target:{id:"itemInstitute",value:o.value}})},noOptionsText:"No se ha encontrado dependencias",id:"itemInstitute",options:i,includeInputInList:!0,sx:{width:300},isOptionEqualToValue:(o,c)=>o.name===c.name,getOptionLabel:({name:o})=>`${o}`,renderInput:o=>n.jsx(I,{...o,name:"dependencia",label:"Dependencia"}),renderOption:(o,c)=>a.createElement(g,{component:"li",...o,key:`institute${c.id}`,value:c.id},c.name)},"filterInstitute"),n.jsx(v,{multiple:!1,id:"itemModule",options:l,onChange:({target:o})=>{h({target:{id:"itemModule",value:o.value}})},noOptionsText:"No se ha encontrado modelos",includeInputInList:!0,sx:{width:300},isOptionEqualToValue:(o,c)=>o.name===c.name,getOptionLabel:({name:o})=>`${o}`,renderInput:o=>n.jsx(I,{...o,label:"Modelo de evaluación"}),renderOption:(o,c)=>a.createElement(g,{component:"li",...o,key:`module${c.id}`,value:c.id},c.name)},"filterModule")]})}const Re=`${y}/v1/condition`,Te=async(i,r="",l="",d="")=>{let s=new URL(Re);r&&s.searchParams.set("page",r),l&&s.searchParams.set("limit",l),d.trim()!==""&&s.searchParams.set("search",d);const u={headers:{Authorization:`Bearer ${i}`}};return(await O.get(s.toString(),u)).data},Pe=`${y}/v1/component`,Le=async(i,r="",l="",d="")=>{let s=new URL(Pe);r&&s.searchParams.set("page",r),l&&s.searchParams.set("limit",l),d.trim()!==""&&s.searchParams.set("search",d);const u={headers:{Authorization:`Bearer ${i}`}};return(await O.get(s.toString(),u)).data},Ve=`${y}/v1/mv`,Ae=async(i,r="",l="",d="")=>{let s=new URL(Ve);r&&s.searchParams.set("page",r),l&&s.searchParams.set("limit",l),d.trim()!==""&&s.searchParams.set("search",d);const u={headers:{Authorization:`Bearer ${i}`}};return(await O.get(s.toString(),u)).data},$e=[{id:"codeSurvey2",label:"Código",minWidth:100},{id:"content",label:"Medio de verificación",minWidth:120,align:"left"},{id:"name_institute",label:"Órgano Responsable",minWidth:120,align:"left"},{id:"send_survey",label:"Enviado",minWidth:80,align:"left"},{id:"status_survey",label:"Estado",minWidth:80,align:"left"},{id:"options",label:"",minWidth:120,align:"left"}];function Ke(){const[i,r]=a.useState(1),[l,d]=a.useState(5),[s,u]=a.useState([]),[m,h]=a.useState(0),[o,c]=a.useState(!1),[x,w]=a.useState(null),[C,M]=a.useState(null),{institute:j,module:b,search:E}=H(),{accessToken:R,user:$}=z(),_=(p,f)=>{r(f+1)},D=p=>{d(parseInt(p.target.value)),r(1)},T=async(p,f=null)=>{if(w(f),M(p),p=="AGREGAR"||p=="COMPARTIR"){c(!0);return}p=="EDITAR"&&c(!0)},S=()=>{c(!1),M(null)},P=async()=>{const{surveys:p,totalRecords:f}=await me(R,i,l,E,j,b);u(p),h(f)};return a.useEffect(()=>{P()},[i,l,j,E,b]),n.jsxs(Ce,{children:[$.role==re.ADMINISTRADOR&&window.location.pathname=="/lista-fichas"&&n.jsxs(q,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[n.jsx(le,{variant:"h4",children:"Fichas"}),n.jsx(J,{variant:"contained",color:"inherit",startIcon:n.jsx(K,{icon:"eva:plus-fill"}),onClick:()=>T("AGREGAR"),children:"Nueva Ficha"})]}),n.jsxs(Se,{children:[n.jsx(Ee,{}),n.jsx(ce,{children:n.jsx(ye,{sx:{overflow:"unset"},children:n.jsxs(Oe,{sx:{minWidth:800},children:[n.jsx(he,{columns:$e}),n.jsxs(we,{children:[s.map(({codeSurvey:p,codeSurvey2:f,means_verification:N,institute:L,component:U,indicator:V,condition:B,allowedEdit:A,statusSurvey:k})=>n.jsx(de,{uuidSurvey:p,code:f,meansVerification:N.content,institute:L.name_institute,component:U.content,indicator:V.content,condition:B.content,isSend:!A,status:k,handleOpenModal:T},p)),s.length<1&&n.jsx(ue,{})]})]})})}),n.jsx(Me,{page:i-1,component:"div",count:m,rowsPerPage:l,onPageChange:_,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:D}),o==1&&C=="COMPARTIR"&&n.jsx(W,{title:"Compartir Ficha",open:o,onCloseModal:S,children:n.jsx(pe,{code:x})}),o==1&&C=="EDITAR"&&n.jsx(W,{title:"Editar Ficha",open:o,onCloseModal:S}),o==1&&C=="AGREGAR"&&n.jsx(ge,{title:"Agregar Ficha",open:o,onCloseModal:S,children:n.jsx(_e,{accessToken:R})})]})]})}function _e({accessToken:i}){const[r,l]=a.useState([]),[d,s]=a.useState([]),[u,m]=a.useState([]),[h,o]=a.useState([]),[c,x]=a.useState([]),[w,C]=a.useState([]),[M,j]=a.useState(""),[b,E]=a.useState(""),[R,$]=a.useState(""),[_,D]=a.useState(""),[T,S]=a.useState(""),[P,p]=a.useState(""),[f,N]=a.useState(""),[L,U]=a.useState(""),[V,B]=a.useState(""),[A,k]=a.useState(""),[F,Y]=a.useState(""),[G,Z]=a.useState("");async function ee(t=""){try{const{indicator:e}=await fe(i,1,10,t);o([...e])}catch(e){console.error(e)}}async function te(t=""){const e=await X(i,1,10,t);l([...e])}async function ne(t=""){try{const{condition:e}=await Te(i,1,10,t);s([...e])}catch(e){console.error(e)}}async function oe(t=""){const{component:e}=await Le(i,1,10,t);m([...e])}async function ae(t=""){const{rowsData:e}=await Ae(i,1,10,t);console.log(e),C([...e])}async function se(t=""){const e=await Q(i,1,10,t);console.log(e),x([...e])}return a.useEffect(()=>{ne(b)},[V]),a.useEffect(()=>{oe(R)},[A]),a.useEffect(()=>{ee(_)},[P]),a.useEffect(()=>{te(M)},[L]),a.useEffect(()=>{ae(f)},[F]),a.useEffect(()=>{se(T)},[G]),n.jsxs(q,{spacing:2,children:[n.jsx(v,{style:{width:"100%"},multiple:!1,onChange:(t,e)=>{j(e.id)},inputValue:L,onInputChange:(t,e)=>{U(e)},id:"optionModule",noOptionsText:"No se ha encontrado modelos",options:r.length>0?r:[],sx:{width:300},getOptionLabel:({name:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"model",label:"Modelo de evaluación"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`model${e.id}`,value:e.id},e.name)}),n.jsx(v,{style:{width:"100%"},multiple:!1,onChange:(t,e)=>{E(e.id)},inputValue:V,onInputChange:(t,e)=>{B(e)},id:"optionCondition",noOptionsText:"No se ha encontrado registros",options:d.length>0?d:[],sx:{width:300},getOptionLabel:({content:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"condicion",label:"Condición"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`condition${e.id}`,value:e.id},e.content)}),n.jsx(v,{style:{width:"100%"},multiple:!1,includeInputInList:!0,onChange:(t,e)=>{$(e.id)},inputValue:A,onInputChange:(t,e)=>{k(e)},id:"optionComponent",noOptionsText:"No se ha encontrado registros",options:u.length>0?u:[],sx:{width:300},getOptionLabel:({content:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"componente",label:"Componente"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`component${e.id}`,value:e.id},e.content)}),n.jsx(v,{style:{width:"100%"},multiple:!1,includeInputInList:!0,onChange:(t,e)=>{D(e.id)},inputValue:P,onInputChange:(t,e)=>{p(e)},id:"optionIndicator",noOptionsText:"No se ha encontrado indicadores",options:h.length>0?h:[],sx:{width:300},getOptionLabel:({content:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"indicador",label:"Indicador"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`indicator${e.id}`,value:e.id},e.content)}),n.jsx(v,{style:{width:"100%"},multiple:!1,includeInputInList:!0,onChange:(t,e)=>{N(e.id)},inputValue:F,onInputChange:(t,e)=>{Y(e)},id:"optionMv",noOptionsText:"No se ha encontrado registros",options:w.length>0?w:[],sx:{width:300},getOptionLabel:({content:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"meansvf",label:"Medio de verificación"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`meansVf${e.id}`,value:e.id},e.content)}),n.jsx(v,{style:{width:"100%"},multiple:!1,includeInputInList:!0,onChange:(t,e)=>{S(e.id)},inputValue:G,onInputChange:(t,e)=>{Z(e)},id:"optionIndicator",noOptionsText:"No se ha encontrado registros",options:c.length>0?c:[],sx:{width:300},getOptionLabel:({name:t})=>`${t}`,isOptionEqualToValue:(t,e)=>t.id===e.id,renderInput:t=>n.jsx(I,{...t,name:"institute",label:"Órgano responsable"}),renderOption:(t,e)=>a.createElement(g,{component:"li",...t,key:`institute${e.id}`,value:e.id},e.name)}),n.jsx(q,{direction:"row",justifyContent:"center",alignItems:"center",spacing:2,sx:{paddingTop:"8px"},children:n.jsx(J,{variant:"contained",endIcon:n.jsx(Ie,{}),onClick:()=>{},style:{backgroundColor:"#1565C0",color:"white"},children:"Guardar"})})]})}export{Ke as S};
