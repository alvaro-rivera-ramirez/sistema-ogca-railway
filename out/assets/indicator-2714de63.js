import{j as e,y as Q,T as I,P as X,D as Y,I as p,r as s,z as Z,C as _,M as S,u as ee,S as b,E as te,W as ne}from"./index-9512049a.js";import{F as P,c as M,a as A,b as O,E as B}from"./validators-caa98503.js";import{T as k,a as w}from"./TableRow-f77894bb.js";import{T as oe,a as re,g as ae,c as se,u as ie}from"./fetchIndicator-fc6684f5.js";import{O as le,T as F}from"./TextField-14413577.js";import{I as ce}from"./InputAdornment-f4cb8bb5.js";import{M as E,S as G}from"./Modal-5cc5ed01.js";import"./label-6573ce96.js";import{S as m}from"./sweetalert2.all-7e086d60.js";import{C as de}from"./Container-7e28c591.js";import{B as y}from"./Button-fd147fd1.js";import{C as he}from"./Menu-7d48820f.js";import{a as ue,b as xe,c as me,d as pe}from"./TablePagination-738ebcf8.js";function W(){return e.jsx(k,{children:e.jsx(w,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Q,{sx:{textAlign:"center"},children:[e.jsx(I,{variant:"h6",paragraph:!0,children:"Lo sentimos!"}),e.jsx(I,{variant:"body2",children:"No se ha encontrado registros en esta secciÃ³n."})]})})})}W.propTypes={query:X.string};function fe({search:o,onChangeSearch:l}){return e.jsx(Y,{sx:{height:96,display:"flex",justifyContent:"space-between",p:i=>i.spacing(0,1,0,3)},children:e.jsx(le,{value:o,onChange:l,placeholder:"Buscar indicador",startAdornment:e.jsx(ce,{position:"start",children:e.jsx(p,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})})})}function ge({id:o,content:l,handleOpenModal:i}){const[u,d]=s.useState(null),h=r=>{d(r.currentTarget)},c=()=>{d(null)},t=(r,a)=>{i(r,a),c()};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{hover:!0,tabIndex:-1,children:[e.jsx(w,{children:l}),e.jsx(w,{align:"right",children:e.jsx(Z,{onClick:h,children:e.jsx(p,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(_,{open:!!u,anchorEl:u,onClose:c,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(S,{onClick:()=>t("EDITAR",o),children:[e.jsx(p,{icon:"eva:edit-fill",sx:{mr:2}}),"Editar"]}),e.jsxs(S,{onClick:()=>t("ELIMINAR",o),sx:{color:"error.main"},children:[e.jsx(p,{icon:"eva:trash-2-outline",sx:{mr:2}}),"Eliminar"]})]})]})}const je=[{id:"content",label:"Indicador",minWidth:120,align:"left"},{id:"options",label:"",minWidth:120,align:"left"}];function Ce(){const[o,l]=s.useState(1),[i,u]=s.useState(5),[d,h]=s.useState([]),[c,t]=s.useState(0),[r,a]=s.useState(!1),[T,D]=s.useState(null),[z,L]=s.useState(null),[j,N]=s.useState(""),[v,V]=s.useState(!0),[$,q]=s.useState({}),{accessToken:f}=ee(),H=(n,x)=>{l(x+1)},U=n=>{u(parseInt(n.target.value)),l(1)},J=({target:n})=>{N(n.value)},R=async(n,x=null)=>{if(L(x),D(n),n=="AGREGAR"){a(!0);return}if(n=="EDITAR"){const{content:K}=await re(f,x);q({content:K}),a(!0)}},g=()=>{a(!1)},C=async()=>{const{indicator:n,totalRecords:x}=await ae(f,o,i,j);h(n),t(x),V(!1)};return s.useEffect(()=>{C()},[o,j,i,v]),e.jsxs(de,{children:[e.jsxs(b,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(I,{variant:"h4",children:"Indicadores"}),e.jsx(y,{variant:"contained",color:"inherit",startIcon:e.jsx(p,{icon:"eva:plus-fill"}),onClick:()=>R("AGREGAR"),children:"Nuevo Indicador"})]}),v==!1&&e.jsxs(he,{children:[e.jsx(fe,{search:j,onChangeSearch:J}),e.jsx(te,{children:e.jsx(ue,{sx:{overflow:"unset"},children:e.jsxs(xe,{sx:{minWidth:800},children:[e.jsx(oe,{columns:je}),e.jsxs(me,{children:[d.map(({id:n,content:x})=>e.jsx(ge,{id:n,content:x,handleOpenModal:R},`rowIndicator${n}`)),d.length<1&&e.jsx(W,{})]})]})})}),e.jsx(pe,{page:o-1,component:"div",count:c,rowsPerPage:i,onPageChange:H,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:U}),r==!0&&T=="AGREGAR"&&e.jsx(E,{title:"Agregar indicador",open:r,onCloseModal:g,children:e.jsx(Ie,{accessToken:f,fetchIndicator:C,onCloseModal:g})}),r==!0&&T=="EDITAR"&&e.jsx(E,{title:"Editar indicador",open:r,onCloseModal:g,children:e.jsx(we,{accessToken:f,record:$,fetchIndicator:C,indicatorId:z,onCloseModal:g})})]})]})}function Ie({accessToken:o,fetchIndicator:l,onCloseModal:i}){const u={content:""},d=async(h,c)=>{try{i(),se(o,h).then(t=>m.fire({title:"Registro creado",icon:"success",showConfirmButton:!1,timer:600}).then(async()=>await l())).catch(t=>{console.log(t),t.response?m.fire({title:"Error!",text:`${t.response.data.error}`,icon:"error",showConfirmButton:!1,timer:800}):m.fire({title:"Error!",text:"Error en el servidor",icon:"error",showConfirmButton:!1,timer:800})}).finally(()=>{c.resetForm()})}catch(t){console.log(t)}};return e.jsx(P,{initialValues:u,validationSchema:M,onSubmit:d,children:({errors:h,touched:c})=>e.jsxs(A,{children:[e.jsx(O,{as:F,label:"Indicador",name:"content",type:"text",multiline:!0,maxRows:4,fullWidth:!0,variant:"outlined",margin:"dense",helperText:e.jsx(B,{name:"content"}),error:h.content&&c.content}),e.jsx(b,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,sx:{paddingTop:"8px"},children:e.jsx(y,{variant:"contained",type:"submit",endIcon:e.jsx(G,{}),style:{backgroundColor:"#1565C0",color:"white"},children:"Guardar"})})]})})}function we({accessToken:o,indicatorId:l,fetchIndicator:i,onCloseModal:u,record:d}){const h={...d},c=async(t,r)=>{try{u(),ie(o,l,t).then(a=>m.fire({title:"Registro actualizado",icon:"success",showConfirmButton:!1,timer:600}).then(async()=>await i())).catch(a=>{console.log(a),a.response?m.fire({title:"Error!",text:`${a.response.data.error}`||"Error en la solicitud",icon:"error",showConfirmButton:!1,timer:800}):m.fire({title:"Error!",text:"Error en el servidor",icon:"error",showConfirmButton:!1,timer:800})}).finally(()=>{r.resetForm()})}catch(a){console.log(a)}};return e.jsx(P,{initialValues:h,validationSchema:M,onSubmit:c,children:({errors:t,touched:r})=>e.jsxs(A,{children:[e.jsx(O,{as:F,label:"Indicador",name:"content",type:"text",multiline:!0,maxRows:4,fullWidth:!0,variant:"outlined",margin:"dense",helperText:e.jsx(B,{name:"content"}),error:t.content&&r.content}),e.jsx(b,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,sx:{paddingTop:"8px"},children:e.jsx(y,{variant:"contained",type:"submit",endIcon:e.jsx(G,{}),style:{backgroundColor:"#1565C0",color:"white"},children:"Guardar"})})]})})}function Fe(){return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:" Indicadores | OGCA "})}),e.jsx(Ce,{})]})}export{Fe as default};
